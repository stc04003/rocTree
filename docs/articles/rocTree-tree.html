<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting ROC-guided survival tree in <code>rocTree</code> package â€¢ rocTree</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fitting ROC-guided survival tree in &lt;code&gt;rocTree&lt;/code&gt; package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rocTree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rocTree-ensemble.html">Fitting ROC-guided ensemble in `rocTree` package</a>
    </li>
    <li>
      <a href="../articles/rocTree-sim.html">Generating simulated data in `rocTree` package</a>
    </li>
    <li>
      <a href="../articles/rocTree-tree.html">Fitting ROC-guided survival tree in `rocTree` package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stc04003/rocTree">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="rocTree-tree_files/htmlwidgets-1.3/htmlwidgets.js"></script><script src="rocTree-tree_files/viz-0.3/viz.js"></script><link href="rocTree-tree_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="rocTree-tree_files/grViz-binding-1.0.1/grViz.js"></script><link href="rocTree-tree_files/vis-4.20.1/vis.css" rel="stylesheet">
<script src="rocTree-tree_files/vis-4.20.1/vis.min.js"></script><script src="rocTree-tree_files/visNetwork-binding-2.0.6/visNetwork.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Fitting ROC-guided survival tree in <code>rocTree</code> package</h1>
                        <h4 class="author">Sy Han (Steven) Chiou</h4>
            
            <h4 class="date">2019-11-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stc04003/rocTree/blob/master/vignettes/rocTree-tree.Rmd"><code>vignettes/rocTree-tree.Rmd</code></a></small>
      <div class="hidden name"><code>rocTree-tree.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we demonstrate how to use the <code>rocTree</code> function in <strong><code>rocTree</code></strong> package to fit the proposed Receiver Operating Characteristic (ROC) guided survival tree.</p>
<div id="simulated-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulated-data" class="anchor"></a>Simulated data</h2>
<p>We will demonstrate the usage of <code>rocTree</code> function with a simulated data prepared by the <a href="https://www.sychiou.com/rocTree/articles/rocTree-sim.html"><code>simu</code></a> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(rocTree)
&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">0</span>)
&gt;<span class="st"> </span>dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simu.html">simu</a></span>(<span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">cen =</span> <span class="fl">0.25</span>, <span class="dt">sce =</span> <span class="fl">2.3</span>, <span class="dt">summary =</span> <span class="ot">TRUE</span>)
Summary results:
Number of subjects:<span class="st"> </span><span class="dv">100</span>
Number of subjects experienced death:<span class="st"> </span><span class="dv">78</span>
Number of covariates:<span class="st"> </span><span class="dv">2</span>
Time independent covaraites:<span class="st"> </span>z1.
Time dependent covaraites:<span class="st"> </span>z2.
Number of unique observation times:<span class="st"> </span><span class="dv">100</span>
Median survival time:<span class="st"> </span><span class="fl">0.6822997</span>
&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(dat)
  id        Time death       z1        z2        k        b
<span class="dv">1</span>  <span class="dv">1</span> <span class="fl">0.002600386</span>     <span class="dv">0</span> <span class="fl">1.609865</span> <span class="fl">0.7828513</span> <span class="fl">1.896697</span> <span class="fl">1.604933</span>
<span class="dv">2</span>  <span class="dv">1</span> <span class="fl">0.004555408</span>     <span class="dv">0</span> <span class="fl">1.613574</span> <span class="fl">0.7828513</span> <span class="fl">1.896697</span> <span class="fl">1.604933</span>
<span class="dv">3</span>  <span class="dv">1</span> <span class="fl">0.020158569</span>     <span class="dv">0</span> <span class="fl">1.643168</span> <span class="fl">0.7828513</span> <span class="fl">1.896697</span> <span class="fl">1.604933</span>
<span class="dv">4</span>  <span class="dv">1</span> <span class="fl">0.027369456</span>     <span class="dv">0</span> <span class="fl">1.656845</span> <span class="fl">0.7828513</span> <span class="fl">1.896697</span> <span class="fl">1.604933</span>
<span class="dv">5</span>  <span class="dv">1</span> <span class="fl">0.047650218</span>     <span class="dv">0</span> <span class="fl">1.695311</span> <span class="fl">0.7828513</span> <span class="fl">1.896697</span> <span class="fl">1.604933</span>
<span class="dv">6</span>  <span class="dv">1</span> <span class="fl">0.053670175</span>     <span class="dv">0</span> <span class="fl">1.706729</span> <span class="fl">0.7828513</span> <span class="fl">1.896697</span> <span class="fl">1.604933</span></code></pre></div>
</div>
<div id="the-roctree-function" class="section level2">
<h2 class="hasAnchor">
<a href="#the-roctree-function" class="anchor"></a>The <code>rocTree</code> function</h2>
<p>The complete list of arguments in <code>rocTree</code> are as follow:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/args">args</a></span>(rocTree)
function (formula, data, id, subset, <span class="dt">ensemble =</span> <span class="ot">TRUE</span>, <span class="dt">splitBy =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"dCON"</span>, 
    <span class="st">"CON"</span>), <span class="dt">control =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>()) 
<span class="ot">NULL</span></code></pre></div>
<p>The arguments are as follows</p>
<ul>
<li>
<code>formula</code> is a formula object, with the response on the left of a <code>~</code> operator, and the predictors on the right. The response must be a survival object returned by the function <code>Surv</code> from the <code>survival</code> package.</li>
<li>
<code>data</code> is an optional data frame to interpret the variables occurring in the <code>formula</code>.</li>
<li>
<code>id</code> is an optional vector used to identify the longitudinal observations of subjectâ€™s id. The length of <code>id</code> should be the same as the total number of observations. If <code>id</code> is missing, then each row of <code>data</code> represents a distinct observation from subjects and all covariates are treated as a baseline covariate.</li>
<li>
<code>subset</code> is an optional vector specifying a subset of observations to be used in the fitting process.</li>
<li>
<code>ensemble</code> is an optional logical value. If <code>TRUE</code> (default), ensemble methods will be fitted. Otherwise, the survival tree will be fitted.</li>
<li>
<code>splitBy</code> is a character string specifying the splitting algorithm. The available options are <code>CON</code> and <code>dCON</code> corresponding to the splitting algorithm based on the total concordance measure or the difference in concordance measure, respectively. The default value is <code>dCON</code>.</li>
<li>
<code>control</code> is a list of control parameters.</li>
</ul>
</div>
<div id="the-control-options" class="section level2">
<h2 class="hasAnchor">
<a href="#the-control-options" class="anchor"></a>The <code>control</code> options</h2>
<p>The argument <code>control</code> defaults to a list with the following values:</p>
<ul>
<li>
<code>tau</code> is the maximum follow-up time; default value is the 90th percentile of the unique observed survival times.</li>
<li>
<code>maxNode</code> is the maximum node number allowed to be in the tree; the default value is <code>500</code>.</li>
<li>
<code>numFold</code> is the number of folds used in the cross-validation. When <code>numFold &gt; 0</code>, the survival tree will be pruned; when <code>numFold = 0</code>, the unpruned survival tree will be presented. The default value is <code>10</code>.</li>
<li>
<code>h</code> is the smoothing parameter used in the Kernel; the default value is <code>tau / 20</code>.</li>
<li>
<code>minSplitTerm</code> is the minimum number of baseline observations in each terminal node; the default value is <code>15</code>.</li>
<li>
<code>minSplitNode</code> is the minimum number of baseline observations in each splitable node; the default value is <code>30</code>.</li>
<li>
<code>disc</code> is a logical vector specifying whether the covariates in <code>formula</code> are discrete (<code>TRUE</code>) or continuous (<code>FALSE</code>). The length of <code>disc</code> should be the same as the number of covariates in <code>formula</code>. When not specified, the <code><a href="../reference/rocTree.html">rocTree()</a></code> function assumes continuous covariates for all.</li>
<li>
<code>K</code> is the number of time points on which the concordance measure is computed. A less refined time grids (smaller <code>K</code>) generally yields faster speed but a very small <code>K</code> is not recommanded. The default value is 20.</li>
</ul>
</div>
<div id="growing-a-survival-tree" class="section level2">
<h2 class="hasAnchor">
<a href="#growing-a-survival-tree" class="anchor"></a>Growing a survival tree</h2>
<p>We first load the <code>survival</code> package to enable the <code><a href="../reference/export_Surv.html">Surv()</a></code> function, which we will use to specify the survival response. The fully grown (un-pruned) time-invariant survival tree can be constructed as follow:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(survival)
&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rocTree.html">rocTree</a></span>(<span class="kw"><a href="../reference/export_Surv.html">Surv</a></span>(Time, death) ~<span class="st"> </span>z1 +<span class="st"> </span>z2, <span class="dt">id =</span> id, <span class="dt">data =</span> dat, 
+<span class="st">                            </span><span class="dt">ensemble =</span> <span class="ot">FALSE</span>, <span class="dt">control =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numFold =</span> <span class="dv">0</span>)))
   user  system elapsed 
  <span class="fl">0.028</span>   <span class="fl">0.000</span>   <span class="fl">0.027</span> </code></pre></div>
<p>The function <code>rocTree</code> returns an object of S3 class with the following major components:</p>
<ul>
<li>
<code>Frame</code> is a data frame describe the resulting tree. The columns are</li>
<li>
<code>p</code> indicate which covariate was split at the node.</li>
<li>
<code>left</code> indicate the row number for the left child (if the current node splittable).</li>
<li>
<code>right</code> indicate the row number for the right child (if the current node splittable).</li>
<li>
<code>cutVal</code> indicate the covariate value (after transformation) being split at the node.</li>
<li>
<code>cutOrd</code> indicate the rank of the covariate value being split at the node.</li>
<li>
<code>nd</code> indicates the node number in display.</li>
<li>
<code>is.terminal</code> describe the node characteristic; <code>0</code> if a node is internal, <code>1</code> if a node is a terminal node.</li>
</ul>
<p>The time-invariant survival tree can be printed directly or with the generic function <code>print</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>fit
 ROC-guided survival tree

 node<span class="er">)</span>, split
   *<span class="st"> </span>denotes terminal node
  
Root                         
 Â¦--<span class="dv">2</span><span class="er">)</span> z1 &lt;=<span class="st"> </span><span class="fl">0.52736</span>         
 Â¦   Â¦--<span class="dv">4</span><span class="er">)</span> z2 &lt;=<span class="st"> </span><span class="fl">0.64179</span>     
 Â¦   Â¦   Â¦--<span class="dv">8</span><span class="er">)</span> z2 &lt;=<span class="st"> </span><span class="fl">0.29353</span>*
<span class="st"> </span>Â¦   Â¦   Â°--<span class="dv">9</span><span class="er">)</span> z2 &gt;<span class="st"> </span><span class="fl">0.29353</span>*<span class="st"> </span>
<span class="st"> </span>Â¦   Â°--<span class="dv">5</span><span class="er">)</span> z2 &gt;<span class="st"> </span><span class="fl">0.64179</span>*<span class="st">     </span>
<span class="st"> </span>Â°--<span class="dv">3</span><span class="er">)</span> z1 &gt;<span class="st"> </span><span class="fl">0.52736</span>          
     Â¦--<span class="dv">6</span><span class="er">)</span> z2 &lt;=<span class="st"> </span><span class="fl">0.67164</span>*<span class="st">    </span>
<span class="st">     </span>Â°--<span class="dv">7</span><span class="er">)</span> z2 &gt;<span class="st"> </span><span class="fl">0.67164</span>*<span class="st">     </span></code></pre></div>
<p>The survival tree is printed in the structure similar to that in the <code>data.tree</code> package.</p>
</div>
<div id="plotting-the-survival-tree" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-the-survival-tree" class="anchor"></a>Plotting the survival tree</h2>
<p>The survival tree can also be plotted with the <code>GraphViz</code>/<code>DiagrammeR</code> engine via the generic function <code>plot</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(fit)</code></pre></div>
<p></p>
<div id="htmlwidget-52af2e5b6fb0322de58a" style="width:576px;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-52af2e5b6fb0322de58a">{"x":{"diagram":"digraph {\n\ngraph [rankdir = \"TB\"]\n\n\n\n  \"1\" [label = \"Root\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"2) z1 <= 0.5274\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"4) z2 <= 0.6418\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"8) z2 <= 0.2935\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"9) z2 > 0.2935\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"6\" [label = \"5) z2 > 0.6418\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"7\" [label = \"3) z1 > 0.5274\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"8\" [label = \"6) z2 <= 0.6716\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"9\" [label = \"7) z2 > 0.6716\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"7\" \n  \"2\"->\"3\" \n  \"2\"->\"6\" \n  \"7\"->\"8\" \n  \"7\"->\"9\" \n  \"3\"->\"4\" \n  \"3\"->\"5\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script> The <code>plot</code> feature also allows the following arguments adopted from the <a href="http://rich-iannone.github.io/DiagrammeR/graphviz_and_mermaid.html"><code>Graphviz</code>/<code>DiagrammeR</code></a> environment to be passed to <code>option</code>:
<ul>
<li>
<code>type</code> is an optional character string specifying what to plot. The available options are <code>tree</code> for plotting survival tree (default), <code>survival</code> for plotting the estimated survival probabilities for the terminal nodes, and <code>hazard</code> for plotting the estimated hazard for the terminal nodes. The following options are available only when <code>type = tree</code>.</li>
<li>
<code>output</code> is a string specifying the output type. The possible values are <code>graph</code> and <code>visNetwork</code>; <code>graph</code> (the default) renders the graph using the <code>grViz</code> function, and <code>visNetwork</code> renders the graph using the <code>visnetwork</code> function.</li>
<li>
<code>digits</code> the number of digits to print.</li>
<li>
<code>rankdir</code> is a character string specifying the direction of the tree flow. The available options are top-to-bottom (<code>TB</code>), bottom-to-top (<code>BT</code>), left-to-right (<code>LR</code>), and right-to-left (<code>RL</code>); the default value is <code>TB</code>.</li>
<li>
<code>shape</code> is a character string specifying the shape style. Some of the available options are <code>ellipse</code>, <code>oval</code>, <code>rectangle</code>, <code>square</code>, <code>egg</code>, <code>plaintext</code>, <code>diamond</code>, and <code>triangle</code>. The default value is <code>ellipse</code>.</li>
<li>
<code>nodeOnly</code> is a logical value indicating whether to display only the node number; the default value is <code>TRUE</code>.</li>
<li>
<code>savePlot</code> is a logical value indicating whether the plot will be saved (exported); the default value is <code>FALSE</code>.</li>
<li>
<code>file_name</code> is a character string specifying the name of the plot when <code>savePlot = TRUE</code>. The file name should include its extension. The default value is <code>pic.pdf</code>.</li>
<li>
<code>file_type</code> is a character string specifying the type of file to be exported. Options for graph files are: <code>png</code>, <code>pdf</code>, <code>svg</code>, and <code>ps</code>. The default value is <code>pdf</code>.</li>
</ul>
<p>The following codes illustrate some of the different options.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(fit, <span class="dt">rankdir =</span> <span class="st">"LR"</span>, <span class="dt">shape =</span> <span class="st">"rect"</span>, <span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<div id="htmlwidget-07d6bc3f5372c4c1f4c4" style="width:576px;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-07d6bc3f5372c4c1f4c4">{"x":{"diagram":"digraph {\n\ngraph [rankdir = \"LR\"]\n\n\n\n  \"1\" [label = \"Root\", fontname = \"helvetica\", shape = \"rect\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"2) z1 <= 0.53\", fontname = \"helvetica\", shape = \"rect\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"4) z2 <= 0.64\", fontname = \"helvetica\", shape = \"rect\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"8) z2 <= 0.29\", fontname = \"helvetica\", shape = \"rect\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"9) z2 > 0.29\", fontname = \"helvetica\", shape = \"rect\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"6\" [label = \"5) z2 > 0.64\", fontname = \"helvetica\", shape = \"rect\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"7\" [label = \"3) z1 > 0.53\", fontname = \"helvetica\", shape = \"rect\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"8\" [label = \"6) z2 <= 0.67\", fontname = \"helvetica\", shape = \"rect\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"9\" [label = \"7) z2 > 0.67\", fontname = \"helvetica\", shape = \"rect\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"7\" \n  \"2\"->\"3\" \n  \"2\"->\"6\" \n  \"7\"->\"8\" \n  \"7\"->\"9\" \n  \"3\"->\"4\" \n  \"3\"->\"5\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(fit, <span class="dt">shape =</span> <span class="st">"egg"</span>, <span class="dt">nodeOnly =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="htmlwidget-8bc2d9714d4c9e76eef7" style="width:576px;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-8bc2d9714d4c9e76eef7">{"x":{"diagram":"digraph {\n\ngraph [rankdir = \"TB\"]\n\n\n\n  \"1\" [label = \"Root\", fontname = \"helvetica\", shape = \"egg\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"Node 2\", fontname = \"helvetica\", shape = \"egg\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"Node 4\", fontname = \"helvetica\", shape = \"egg\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"Node 8\", fontname = \"helvetica\", shape = \"egg\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"Node 9\", fontname = \"helvetica\", shape = \"egg\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"6\" [label = \"Node 5\", fontname = \"helvetica\", shape = \"egg\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"7\" [label = \"Node 3\", fontname = \"helvetica\", shape = \"egg\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"8\" [label = \"Node 6\", fontname = \"helvetica\", shape = \"egg\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"9\" [label = \"Node 7\", fontname = \"helvetica\", shape = \"egg\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"7\" \n  \"2\"->\"3\" \n  \"2\"->\"6\" \n  \"7\"->\"8\" \n  \"7\"->\"9\" \n  \"3\"->\"4\" \n  \"3\"->\"5\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(fit, <span class="dt">output =</span> <span class="st">"visNetwork"</span>, <span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<div id="htmlwidget-e11d196caf066fabf02a" style="width:576px;height:432.632880098888px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-e11d196caf066fabf02a">{"x":{"nodes":{"id":[1,2,3,4,5,6,7,8,9],"group":[null,null,null,null,null,null,null,null,null],"label":["Root","2) z1 <= 0.53","4) z2 <= 0.64","8) z2 <= 0.29","9) z2 > 0.29","5) z2 > 0.64","3) z1 > 0.53","6) z2 <= 0.67","7) z2 > 0.67"],"fontname":["helvetica","helvetica","helvetica","helvetica","helvetica","helvetica","helvetica","helvetica","helvetica"],"shape":["ellipse","ellipse","ellipse","ellipse","ellipse","ellipse","ellipse","ellipse","ellipse"]},"edges":{"id":[1,2,3,4,5,6,7,8],"from":[1,1,2,2,7,7,3,3],"to":[2,7,3,6,8,9,4,5],"label":[null,null,null,null,null,null,null,null]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"edges":{"arrows":{"to":{"enabled":true,"scaleFactor":1}}},"physics":{"stabilization":{"enabled":true,"onlyDynamicEdges":false,"fit":true}},"layout":{"improvedLayout":true}},"groups":[null],"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="pruning-the-survival-tree" class="section level2">
<h2 class="hasAnchor">
<a href="#pruning-the-survival-tree" class="anchor"></a>Pruning the survival tree</h2>
<p>Pruning reduces the complexity of the final classifier, and hence improves predictive accuracy by the reduction of overfitting. Setting <code>prune = TRUE</code> in the <code>control</code> list will prune the survival tree. In the following example, we used five-fold cross-validation to choose the tuning parameter in the concordance-complexity measure:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(fit2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rocTree.html">rocTree</a></span>(<span class="kw"><a href="../reference/export_Surv.html">Surv</a></span>(Time, death) ~<span class="st"> </span>z1 +<span class="st"> </span>z2, <span class="dt">id =</span> id, <span class="dt">data =</span> dat, 
+<span class="st">     </span><span class="dt">ensemble =</span> <span class="ot">FALSE</span>, <span class="dt">control =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numFold =</span> <span class="dv">10</span>)))
   user  system elapsed 
  <span class="fl">0.056</span>   <span class="fl">0.000</span>   <span class="fl">0.053</span> 
&gt;<span class="st"> </span>fit2
 ROC-guided survival tree

 node<span class="er">)</span>, split
   *<span class="st"> </span>denotes terminal node
  
Root                 
 Â¦--<span class="dv">2</span><span class="er">)</span> z1 &lt;=<span class="st"> </span><span class="fl">0.52736</span>*
<span class="st"> </span>Â°--<span class="dv">3</span><span class="er">)</span> z1 &gt;<span class="st"> </span><span class="fl">0.52736</span>*<span class="st"> </span>
<span class="er">&gt;</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(fit2)</code></pre></div>
<p></p>
<div id="htmlwidget-fe8887552c85f26f1aab" style="width:700px;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-fe8887552c85f26f1aab">{"x":{"diagram":"digraph {\n\ngraph [rankdir = \"TB\"]\n\n\n\n  \"1\" [label = \"Root\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"2) z1 <= 0.5274\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"3) z1 > 0.5274\", fontname = \"helvetica\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"3\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script> The resulting tree is much smaller than the un-pruned tree in <code>fit</code>.
</div>
<div id="survivalhazard-estimates-at-terminal-notes" class="section level2">
<h2 class="hasAnchor">
<a href="#survivalhazard-estimates-at-terminal-notes" class="anchor"></a>Survival/Hazard estimates at terminal notes</h2>
<p>The time-invariant partition considered allows a sparse model and an easy interpretation of the decision rule. At each fixed time <span class="math inline">\(t\)</span>, the tree partitions the survivor population and predicts the instantaneous failure risk. Thus the interpretation at a fixed time point is along the same line as classification and regression trees. Since the risk within each terminal node changes with time, it is essential to look at the hazard curves of each terminal The smoothed hazard estimates at terminal nodes can be easily plotted with the generic function <code>plot</code> with <code>type = "survival"</code> or <code>type = "hazard"</code>. The feature is demonstrated below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(fit2, <span class="dt">type =</span> <span class="st">"hazard"</span>)</code></pre></div>
<p><img src="rocTree-tree_files/figure-html/haz-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="prediction" class="section level2">
<h2 class="hasAnchor">
<a href="#prediction" class="anchor"></a>Prediction</h2>
<p>Suppose we have a new data that is generated as below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>newdat &lt;-<span class="st"> </span>dplyr::<span class="kw">tibble</span>(<span class="dt">Time =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(dat$Time)), 
+<span class="st">                         </span><span class="dt">z1 =</span> <span class="dv">1</span> *<span class="st"> </span>(Time &lt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/median">median</a></span>(Time)), 
+<span class="st">                         </span><span class="dt">z2 =</span> <span class="fl">0.5</span>)
&gt;<span class="st"> </span>newdat
<span class="co"># A tibble: 100 x 3</span>
      Time    z1    z2
     &lt;dbl&gt;<span class="st"> </span><span class="er">&lt;</span>dbl&gt;<span class="st"> </span><span class="er">&lt;</span>dbl&gt;
<span class="st"> </span><span class="dv">1</span> <span class="fl">0.00260</span>     <span class="dv">1</span>   <span class="fl">0.5</span>
 <span class="dv">2</span> <span class="fl">0.00456</span>     <span class="dv">1</span>   <span class="fl">0.5</span>
 <span class="dv">3</span> <span class="fl">0.0202</span>      <span class="dv">1</span>   <span class="fl">0.5</span>
 <span class="dv">4</span> <span class="fl">0.0274</span>      <span class="dv">1</span>   <span class="fl">0.5</span>
 <span class="dv">5</span> <span class="fl">0.0477</span>      <span class="dv">1</span>   <span class="fl">0.5</span>
 <span class="dv">6</span> <span class="fl">0.0537</span>      <span class="dv">1</span>   <span class="fl">0.5</span>
 <span class="dv">7</span> <span class="fl">0.0564</span>      <span class="dv">1</span>   <span class="fl">0.5</span>
 <span class="dv">8</span> <span class="fl">0.0572</span>      <span class="dv">1</span>   <span class="fl">0.5</span>
 <span class="dv">9</span> <span class="fl">0.0587</span>      <span class="dv">1</span>   <span class="fl">0.5</span>
<span class="dv">10</span> <span class="fl">0.0589</span>      <span class="dv">1</span>   <span class="fl">0.5</span>
<span class="co"># â€¦ with 90 more rows</span></code></pre></div>
<p>The predicted survival curve can be plotted with the following codes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>(pred &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(fit2, newdat, <span class="dt">type =</span> <span class="st">"survival"</span>))
 Fitted survival probabilities:
<span class="st">         </span>Time Survival
<span class="dv">1</span> <span class="fl">0.002600386</span> <span class="fl">0.980953</span>
<span class="dv">2</span> <span class="fl">0.004555408</span> <span class="fl">0.980953</span>
<span class="dv">3</span> <span class="fl">0.020158569</span> <span class="fl">0.980953</span>
<span class="dv">4</span> <span class="fl">0.027369456</span> <span class="fl">0.980953</span>
<span class="dv">5</span> <span class="fl">0.047650218</span> <span class="fl">0.980953</span>
&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(pred)</code></pre></div>
<p><img src="rocTree-tree_files/figure-html/pred-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>(pred &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(fit2, newdat, <span class="dt">type =</span> <span class="st">"hazard"</span>))
 Fitted cumulative hazard:
<span class="st">        </span>Time    hazard
<span class="dv">1</span> <span class="fl">0.05336918</span> <span class="fl">0.2931508</span>
<span class="dv">2</span> <span class="fl">0.12010736</span> <span class="fl">0.1140868</span>
<span class="dv">3</span> <span class="fl">0.18684555</span> <span class="fl">0.2628478</span>
<span class="dv">4</span> <span class="fl">0.25358374</span> <span class="fl">0.3424780</span>
<span class="dv">5</span> <span class="fl">0.32032193</span> <span class="fl">0.0000000</span>
&gt;<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(pred)</code></pre></div>
<p><img src="rocTree-tree_files/figure-html/pred-2.png" width="700"></p>
<div id="refs" class="references">

</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simulated-data">Simulated data</a></li>
      <li><a href="#the-roctree-function">The <code>rocTree</code> function</a></li>
      <li><a href="#the-control-options">The <code>control</code> options</a></li>
      <li><a href="#growing-a-survival-tree">Growing a survival tree</a></li>
      <li><a href="#plotting-the-survival-tree">Plotting the survival tree</a></li>
      <li><a href="#pruning-the-survival-tree">Pruning the survival tree</a></li>
      <li><a href="#survivalhazard-estimates-at-terminal-notes">Survival/Hazard estimates at terminal notes</a></li>
      <li><a href="#prediction">Prediction</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Yifei Sun, Mei-Cheng Wang, Sy Han Chiou.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
